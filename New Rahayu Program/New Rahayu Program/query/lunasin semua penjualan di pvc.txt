INSERT INTO PVCSalesPayment (pvcSalesID, pvcPaymentID, ammount, paymentTime, paymentMethod, pending)
SELECT DISTINCT psh.pvcSalesID, 1, (SELECT SUM(quantity * sellPrice) FROM PVCSalesDetail WHERE pvcSalesID = psh.pvcSalesID) - (SELECT IFNULL(SUM(psp.ammount),0) FROM PVCSalesPayment psp WHERE psh.pvcSalesID = pvcSalesID), now(), 'RESET', 0 FROM PVCSalesHeader psh JOIN MsCustomer mc ON psh.customerID = mc.customerID JOIN PVCSalesDetail psd ON psh.pvcSalesID = psd.pvcSalesID 
WHERE psh.pvcSalesID IN (SELECT psh.pvcSalesID FROM PVCSalesHeader psh, PVCSalesPayment psp WHERE NOT psh.pvcSalesID IN (SELECT pvcSalesID FROM PVCSalesPayment WHERE psh.pvcSalesID = pvcSalesID) GROUP BY psh.pvcSalesID UNION SELECT psh.pvcSalesID FROM PVCSalesHeader psh WHERE (SELECT SUM(ammount) FROM PVCSalesPayment WHERE pvcSalesID = psh.pvcSalesID) = 0)